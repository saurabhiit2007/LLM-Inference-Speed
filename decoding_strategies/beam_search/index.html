
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A technical reference for LoRA, QLoRA, and other fine-tuning techniques.">
      
      
        <meta name="author" content="Saurabh Goyal">
      
      
      
        <link rel="prev" href="../greedy_decoding/">
      
      
        <link rel="next" href="../sampling_methods/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Beam Search - Fine-Tuning Methods Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#beam-search-interview-prep-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Fine-Tuning Methods Documentation" class="md-header__button md-logo" aria-label="Fine-Tuning Methods Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fine-Tuning Methods Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Beam Search
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-purple"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="lime"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/saurabhiit2007/LLM-Finetuning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Fine-Tuning Methods Documentation" class="md-nav__button md-logo" aria-label="Fine-Tuning Methods Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Fine-Tuning Methods Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/saurabhiit2007/LLM-Finetuning" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/inference_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/bottleneck_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bottleneck Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/latency_vs_throughput/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Latency vs Throughput
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/memory_compute_tradeoffs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory Compute Tradeoffs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Attention Optimization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Attention Optimization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attention_optimization/flash_attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flash Attention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attention_optimization/flash_attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flash Attention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attention_optimization/kv_caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KV Caching
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attention_optimization/vllm.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vLLM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Decoding Strategies
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Decoding Strategies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../greedy_decoding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Greedy Decoding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Beam Search
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Beam Search
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1. Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      2. How It Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-example-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      3. Example Walkthrough
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Example Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-first-token" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: First Token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-second-token" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Second Token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-key-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      4. Key Characteristics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Key Characteristics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explores-multiple-paths" class="md-nav__link">
    <span class="md-ellipsis">
      Explores Multiple Paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#length-bias-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Length Bias Problem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-common-problems" class="md-nav__link">
    <span class="md-ellipsis">
      5. Common Problems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Common Problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-reduced-diversity" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1: Reduced Diversity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-generic-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2: Generic Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-3-computational-cost" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 3: Computational Cost
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-length-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      6. Length Normalization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Length Normalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#without-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      Without Normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      With Normalization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-when-to-use-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      7. When to Use Beam Search
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. When to Use Beam Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#good-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Good Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#poor-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Poor Use Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-variants-and-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      8. Variants and Improvements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Variants and Improvements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diverse-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Diverse Beam Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constrained-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Constrained Beam Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stochastic-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Stochastic Beam Search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-interview-questions" class="md-nav__link">
    <span class="md-ellipsis">
      9. Interview Questions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Interview Questions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q1-what-is-beam-search-and-how-does-it-differ-from-greedy-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      Q1: What is beam search and how does it differ from greedy decoding?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q2-why-use-log-probabilities-instead-of-regular-probabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Q2: Why use log probabilities instead of regular probabilities?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q3-what-is-the-length-bias-problem-in-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Q3: What is the length bias problem in beam search?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q4-why-does-beam-search-produce-less-diverse-outputs-than-sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Q4: Why does beam search produce less diverse outputs than sampling?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q5-whats-the-computational-complexity-of-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Q5: What's the computational complexity of beam search?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q6-how-do-you-choose-the-optimal-beam-width-k" class="md-nav__link">
    <span class="md-ellipsis">
      Q6: How do you choose the optimal beam width K?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q7-can-beam-search-guarantee-finding-the-optimal-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      Q7: Can beam search guarantee finding the optimal sequence?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q8-what-is-diverse-beam-search-and-when-is-it-useful" class="md-nav__link">
    <span class="md-ellipsis">
      Q8: What is diverse beam search and when is it useful?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q9-when-would-you-use-beam-search-over-sampling-methods-like-top-p" class="md-nav__link">
    <span class="md-ellipsis">
      Q9: When would you use beam search over sampling methods like top-p?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q10-how-does-beam-search-handle-the-eos-token" class="md-nav__link">
    <span class="md-ellipsis">
      Q10: How does beam search handle the EOS token?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-code-example" class="md-nav__link">
    <span class="md-ellipsis">
      10. Code Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-key-takeaways-for-interviews" class="md-nav__link">
    <span class="md-ellipsis">
      11. Key Takeaways for Interviews
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sampling_methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sampling Methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attention_optimization/speculative_decoding.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Speculative Decoding
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../batching_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batching Strategies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Quantization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Quantization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/quantization_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantization Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/int8_quantization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    INT8 Quantization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/int4_quantization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    INT4 Quantization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/gptq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPTQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/gguf_ggml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GGUF GGML
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/awq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/smoothquant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SmoothQuant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quantization/quantization_tradeoffs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantization Tradeoffs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Serving Frameworks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Serving Frameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serving_frameworks/deepspeed_inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DeepSpeed Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serving_frameworks/tensorrt_llm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TensorRT LLM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serving_frameworks/vllm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vLLM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serving_frameworks/text_generation_inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Generation Inference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serving_frameworks/triton_inference_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triton Inference Server
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1. Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      2. How It Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. How It Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-example-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      3. Example Walkthrough
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Example Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-first-token" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: First Token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-second-token" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Second Token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-key-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      4. Key Characteristics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Key Characteristics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explores-multiple-paths" class="md-nav__link">
    <span class="md-ellipsis">
      Explores Multiple Paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#length-bias-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Length Bias Problem
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-common-problems" class="md-nav__link">
    <span class="md-ellipsis">
      5. Common Problems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Common Problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-reduced-diversity" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1: Reduced Diversity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-generic-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2: Generic Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-3-computational-cost" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 3: Computational Cost
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-length-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      6. Length Normalization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Length Normalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#without-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      Without Normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      With Normalization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-when-to-use-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      7. When to Use Beam Search
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. When to Use Beam Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#good-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Good Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#poor-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Poor Use Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-variants-and-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      8. Variants and Improvements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Variants and Improvements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diverse-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Diverse Beam Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constrained-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Constrained Beam Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stochastic-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Stochastic Beam Search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-interview-questions" class="md-nav__link">
    <span class="md-ellipsis">
      9. Interview Questions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Interview Questions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q1-what-is-beam-search-and-how-does-it-differ-from-greedy-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      Q1: What is beam search and how does it differ from greedy decoding?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q2-why-use-log-probabilities-instead-of-regular-probabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Q2: Why use log probabilities instead of regular probabilities?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q3-what-is-the-length-bias-problem-in-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Q3: What is the length bias problem in beam search?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q4-why-does-beam-search-produce-less-diverse-outputs-than-sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Q4: Why does beam search produce less diverse outputs than sampling?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q5-whats-the-computational-complexity-of-beam-search" class="md-nav__link">
    <span class="md-ellipsis">
      Q5: What's the computational complexity of beam search?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q6-how-do-you-choose-the-optimal-beam-width-k" class="md-nav__link">
    <span class="md-ellipsis">
      Q6: How do you choose the optimal beam width K?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q7-can-beam-search-guarantee-finding-the-optimal-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      Q7: Can beam search guarantee finding the optimal sequence?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q8-what-is-diverse-beam-search-and-when-is-it-useful" class="md-nav__link">
    <span class="md-ellipsis">
      Q8: What is diverse beam search and when is it useful?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q9-when-would-you-use-beam-search-over-sampling-methods-like-top-p" class="md-nav__link">
    <span class="md-ellipsis">
      Q9: When would you use beam search over sampling methods like top-p?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q10-how-does-beam-search-handle-the-eos-token" class="md-nav__link">
    <span class="md-ellipsis">
      Q10: How does beam search handle the EOS token?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-code-example" class="md-nav__link">
    <span class="md-ellipsis">
      10. Code Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-key-takeaways-for-interviews" class="md-nav__link">
    <span class="md-ellipsis">
      11. Key Takeaways for Interviews
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="beam-search-interview-prep-guide">Beam Search - Interview Prep Guide<a class="headerlink" href="#beam-search-interview-prep-guide" title="Permanent link">&para;</a></h1>
<h2 id="1-overview">1. Overview<a class="headerlink" href="#1-overview" title="Permanent link">&para;</a></h2>
<p>Beam search maintains <strong>K candidate sequences</strong> (beams) at each decoding step and selects the sequence with the highest <strong>cumulative probability</strong>. It balances between greedy decoding (K=1) and exhaustive search (K=vocab_size).</p>
<p><strong>Key insight:</strong> Explore multiple promising paths simultaneously to avoid getting stuck in locally optimal but globally suboptimal sequences.</p>
<hr />
<h2 id="2-how-it-works">2. How It Works<a class="headerlink" href="#2-how-it-works" title="Permanent link">&para;</a></h2>
<h3 id="algorithm">Algorithm<a class="headerlink" href="#algorithm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">beam_search</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">beam_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="c1"># Initialize: One beam with the prompt</span>
    <span class="n">beams</span> <span class="o">=</span> <span class="p">[(</span><span class="n">prompt</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]</span>  <span class="c1"># (sequence, cumulative_log_prob)</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Expand each beam</span>
        <span class="k">for</span> <span class="n">seq</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">EOS</span><span class="p">:</span>  <span class="c1"># Completed sequence</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seq</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>

            <span class="c1"># Consider all tokens</span>
            <span class="k">for</span> <span class="n">token_id</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">probs</span><span class="p">):</span>
                <span class="n">new_seq</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">+</span> <span class="p">[</span><span class="n">token_id</span><span class="p">]</span>
                <span class="n">new_score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>  <span class="c1"># Cumulative log probability</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_seq</span><span class="p">,</span> <span class="n">new_score</span><span class="p">))</span>

        <span class="c1"># Keep top K beams</span>
        <span class="n">beams</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="n">beam_width</span><span class="p">]</span>

        <span class="c1"># Stop if all beams are complete</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">EOS</span> <span class="k">for</span> <span class="n">seq</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">beams</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">beams</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Return best sequence</span>
</code></pre></div>
<h3 id="core-concepts">Core Concepts<a class="headerlink" href="#core-concepts" title="Permanent link">&para;</a></h3>
<p><strong>Beam width (K):</strong>
- K=1: Greedy decoding
- K=5-10: Typical for translation
- K=50+: Exhaustive (expensive)</p>
<p><strong>Cumulative log probability:</strong>
- Use log probabilities to avoid numerical underflow
- Score = log(P₁) + log(P₂) + ... + log(Pₙ)
- Equivalent to log(P₁ × P₂ × ... × Pₙ)</p>
<hr />
<h2 id="3-example-walkthrough">3. Example Walkthrough<a class="headerlink" href="#3-example-walkthrough" title="Permanent link">&para;</a></h2>
<p><strong>Prompt:</strong> "The cat sat on the"</p>
<p><strong>Beam width:</strong> 3</p>
<h3 id="step-1-first-token">Step 1: First Token<a class="headerlink" href="#step-1-first-token" title="Permanent link">&para;</a></h3>
<p>Model probabilities:
| Token | Probability | Log Prob |
|-------|-------------|----------|
| mat   | 0.40        | -0.92    |
| floor | 0.25        | -1.39    |
| sofa  | 0.15        | -1.90    |
| bed   | 0.10        | -2.30    |</p>
<p><strong>Top 3 beams:</strong>
1. "The cat sat on the mat" → score: -0.92
2. "The cat sat on the floor" → score: -1.39
3. "The cat sat on the sofa" → score: -1.90</p>
<h3 id="step-2-second-token">Step 2: Second Token<a class="headerlink" href="#step-2-second-token" title="Permanent link">&para;</a></h3>
<p>Expand each beam:</p>
<p><strong>Beam 1:</strong> "mat" + next token
- "mat ." → -0.92 + (-0.51) = <strong>-1.43</strong>
- "mat and" → -0.92 + (-1.61) = -2.53</p>
<p><strong>Beam 2:</strong> "floor" + next token
- "floor ." → -1.39 + (-0.36) = <strong>-1.75</strong>
- "floor while" → -1.39 + (-1.20) = -2.59</p>
<p><strong>Beam 3:</strong> "sofa" + next token
- "sofa ." → -1.90 + (-0.41) = -2.31
- "sofa when" → -1.90 + (-0.51) = <strong>-2.41</strong></p>
<p><strong>New top 3 beams:</strong>
1. "The cat sat on the mat ." → -1.43
2. "The cat sat on the floor ." → -1.75
3. "The cat sat on the sofa when" → -2.41</p>
<p><strong>Final output:</strong> "The cat sat on the mat."</p>
<hr />
<h2 id="4-key-characteristics">4. Key Characteristics<a class="headerlink" href="#4-key-characteristics" title="Permanent link">&para;</a></h2>
<h3 id="explores-multiple-paths">Explores Multiple Paths<a class="headerlink" href="#explores-multiple-paths" title="Permanent link">&para;</a></h3>
<p>Unlike greedy, beam search maintains K hypotheses:
- Can recover from locally suboptimal choices
- Considers alternative continuations
- Better global optimization</p>
<h3 id="length-bias-problem">Length Bias Problem<a class="headerlink" href="#length-bias-problem" title="Permanent link">&para;</a></h3>
<p>Longer sequences accumulate more negative log probabilities:
<div class="highlight"><pre><span></span><code>Seq 1 (length 5): -0.5 + -0.6 + -0.4 + -0.5 + -0.3 = -2.3
Seq 2 (length 3): -0.5 + -0.6 + -0.4 = -1.5
</code></pre></div></p>
<p>Seq 2 has higher score despite being incomplete!</p>
<p><strong>Solution: Length normalization</strong>
<div class="highlight"><pre><span></span><code><span class="n">normalized_score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">/</span> <span class="n">length</span><span class="o">^</span><span class="n">α</span>
<span class="c1"># α = 0.6-0.8 typical</span>
<span class="c1"># α = 0: no normalization</span>
<span class="c1"># α = 1: full normalization</span>
</code></pre></div></p>
<hr />
<h2 id="5-common-problems">5. Common Problems<a class="headerlink" href="#5-common-problems" title="Permanent link">&para;</a></h2>
<h3 id="problem-1-reduced-diversity">Problem 1: Reduced Diversity<a class="headerlink" href="#problem-1-reduced-diversity" title="Permanent link">&para;</a></h3>
<p>All beams often converge to similar outputs:</p>
<div class="highlight"><pre><span></span><code>Prompt: &quot;I think that&quot;

Beam 1: &quot;I think that we should focus on...&quot;
Beam 2: &quot;I think that we need to consider...&quot;
Beam 3: &quot;I think that this is important...&quot;
</code></pre></div>
<p>All beams start with safe, high-probability tokens → similar continuations.</p>
<p><strong>Why:</strong> Beam search favors <strong>safe, high-probability paths</strong> over <strong>diverse, creative paths</strong>.</p>
<h3 id="problem-2-generic-outputs">Problem 2: Generic Outputs<a class="headerlink" href="#problem-2-generic-outputs" title="Permanent link">&para;</a></h3>
<p>In open-ended generation:
<div class="highlight"><pre><span></span><code>Prompt: &quot;Tell me a story about&quot;

Greedy: &quot;a boy who lived in&quot;
Beam (K=5): &quot;a young boy who lived in a small town&quot;
</code></pre></div></p>
<p>Beam search produces grammatically perfect but boring text.</p>
<h3 id="problem-3-computational-cost">Problem 3: Computational Cost<a class="headerlink" href="#problem-3-computational-cost" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Memory:</strong> O(K × T × V) for storing beam candidates</li>
<li><strong>Time:</strong> O(K × V) per step (vs O(V) for greedy)</li>
<li>K=10 → 10× slower than greedy</li>
</ul>
<hr />
<h2 id="6-length-normalization">6. Length Normalization<a class="headerlink" href="#6-length-normalization" title="Permanent link">&para;</a></h2>
<h3 id="without-normalization">Without Normalization<a class="headerlink" href="#without-normalization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Shorter sequences preferred</span>
<span class="n">beams</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h3 id="with-normalization">With Normalization<a class="headerlink" href="#with-normalization" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">length_penalty</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="mi">5</span> <span class="o">+</span> <span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span>  <span class="c1"># Google NMT formula</span>

<span class="c1"># Normalized score</span>
<span class="n">normalized</span> <span class="o">=</span> <span class="n">score</span> <span class="o">/</span> <span class="n">length_penalty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">beams</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">normalized_score</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>Effect:</strong>
- Encourages longer, more complete sequences
- Prevents premature termination
- Essential for translation and summarization</p>
<hr />
<h2 id="7-when-to-use-beam-search">7. When to Use Beam Search<a class="headerlink" href="#7-when-to-use-beam-search" title="Permanent link">&para;</a></h2>
<h3 id="good-use-cases">✅ Good Use Cases<a class="headerlink" href="#good-use-cases" title="Permanent link">&para;</a></h3>
<p><strong>Structured tasks with clear objectives:</strong>
- Machine translation
- Automatic speech recognition (ASR)
- Image captioning
- Summarization
- Question answering (extractive)</p>
<p><strong>When correctness matters more than creativity:</strong>
- Technical documentation generation
- Code comment generation
- Medical report generation</p>
<h3 id="poor-use-cases">❌ Poor Use Cases<a class="headerlink" href="#poor-use-cases" title="Permanent link">&para;</a></h3>
<p><strong>Creative or conversational tasks:</strong>
- Story writing
- Dialogue systems
- Chatbots
- Poetry generation</p>
<p><strong>Tasks requiring diversity:</strong>
- Brainstorming
- Multiple solution generation
- Creative writing</p>
<hr />
<h2 id="8-variants-and-improvements">8. Variants and Improvements<a class="headerlink" href="#8-variants-and-improvements" title="Permanent link">&para;</a></h2>
<h3 id="diverse-beam-search">Diverse Beam Search<a class="headerlink" href="#diverse-beam-search" title="Permanent link">&para;</a></h3>
<p>Force beams to be dissimilar using diversity penalty:
<div class="highlight"><pre><span></span><code><span class="n">diversity_penalty</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="k">for</span> <span class="n">beam_group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="c1"># Penalize tokens already chosen by other groups</span>
    <span class="n">adjusted_score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">-</span> <span class="n">diversity_penalty</span> <span class="o">*</span> <span class="n">overlap_count</span>
</code></pre></div></p>
<h3 id="constrained-beam-search">Constrained Beam Search<a class="headerlink" href="#constrained-beam-search" title="Permanent link">&para;</a></h3>
<p>Force inclusion of specific tokens/phrases:
<div class="highlight"><pre><span></span><code><span class="c1"># E.g., must include &quot;climate change&quot; in summary</span>
<span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;climate&quot;</span><span class="p">,</span> <span class="s2">&quot;change&quot;</span><span class="p">]</span>
<span class="c1"># Only keep beams that satisfy constraints</span>
</code></pre></div></p>
<h3 id="stochastic-beam-search">Stochastic Beam Search<a class="headerlink" href="#stochastic-beam-search" title="Permanent link">&para;</a></h3>
<p>Add randomness to beam selection for more diversity.</p>
<hr />
<h2 id="9-interview-questions">9. Interview Questions<a class="headerlink" href="#9-interview-questions" title="Permanent link">&para;</a></h2>
<h3 id="q1-what-is-beam-search-and-how-does-it-differ-from-greedy-decoding">Q1: What is beam search and how does it differ from greedy decoding?<a class="headerlink" href="#q1-what-is-beam-search-and-how-does-it-differ-from-greedy-decoding" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Beam search maintains K candidate sequences (beams) instead of just one. At each step, it expands all beams, scores all possible continuations, and keeps the top K. This allows exploration of multiple paths and can recover from locally suboptimal choices, unlike greedy which commits to a single path.</p>
<hr />
<h3 id="q2-why-use-log-probabilities-instead-of-regular-probabilities">Q2: Why use log probabilities instead of regular probabilities?<a class="headerlink" href="#q2-why-use-log-probabilities-instead-of-regular-probabilities" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Two reasons:
1. <strong>Numerical stability:</strong> Multiplying many small probabilities (0.3 × 0.4 × 0.2...) quickly underflows to zero in floating point
2. <strong>Computational efficiency:</strong> Log transforms products to sums: log(P₁ × P₂) = log(P₁) + log(P₂), which is more stable and efficient</p>
<hr />
<h3 id="q3-what-is-the-length-bias-problem-in-beam-search">Q3: What is the length bias problem in beam search?<a class="headerlink" href="#q3-what-is-the-length-bias-problem-in-beam-search" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Longer sequences accumulate more negative log probabilities, making them score lower than shorter sequences even if they're more complete. For example, a 10-token sequence might score -8.5 while a 5-token incomplete sequence scores -3.2. Length normalization (dividing by sequence length raised to α) addresses this by favoring complete sentences.</p>
<hr />
<h3 id="q4-why-does-beam-search-produce-less-diverse-outputs-than-sampling">Q4: Why does beam search produce less diverse outputs than sampling?<a class="headerlink" href="#q4-why-does-beam-search-produce-less-diverse-outputs-than-sampling" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Beam search is <strong>deterministic</strong> and <strong>risk-averse</strong>—it keeps the K highest-probability sequences. This means all beams tend to follow safe, high-probability paths, leading to similar outputs. Rare but creative continuations are discarded early. Sampling methods can explore lower-probability tokens, leading to more diversity.</p>
<hr />
<h3 id="q5-whats-the-computational-complexity-of-beam-search">Q5: What's the computational complexity of beam search?<a class="headerlink" href="#q5-whats-the-computational-complexity-of-beam-search" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong>
- <strong>Time per step:</strong> O(K × V) where K=beam width, V=vocab size
  - Greedy: O(V), so beam is K× slower
- <strong>Memory:</strong> O(K × T) to store K beams of length T
- <strong>Total:</strong> For T steps, O(K × V × T) time</p>
<p>Typical K=5-10 for translation, but this 5-10× slowdown is significant.</p>
<hr />
<h3 id="q6-how-do-you-choose-the-optimal-beam-width-k">Q6: How do you choose the optimal beam width K?<a class="headerlink" href="#q6-how-do-you-choose-the-optimal-beam-width-k" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Trade-off between quality and speed:
- <strong>K=1:</strong> Greedy (fast, low quality)
- <strong>K=5-10:</strong> Standard for translation (good balance)
- <strong>K=50+:</strong> Diminishing returns, very slow</p>
<p>Empirically, quality plateaus around K=10 for most tasks. Beyond that, you get marginal gains for significant computational cost.</p>
<hr />
<h3 id="q7-can-beam-search-guarantee-finding-the-optimal-sequence">Q7: Can beam search guarantee finding the optimal sequence?<a class="headerlink" href="#q7-can-beam-search-guarantee-finding-the-optimal-sequence" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> No. Beam search is a <strong>heuristic</strong> that prunes the search space. It only explores the top K paths at each step, potentially discarding paths that could lead to the globally optimal sequence later. Full exhaustive search (K=|V|^T) is computationally infeasible, so beam search is a practical approximation.</p>
<hr />
<h3 id="q8-what-is-diverse-beam-search-and-when-is-it-useful">Q8: What is diverse beam search and when is it useful?<a class="headerlink" href="#q8-what-is-diverse-beam-search-and-when-is-it-useful" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Diverse beam search forces different beam groups to explore different areas of the search space by penalizing similarity. It's useful when you need multiple distinct outputs (e.g., generating K different translations or summaries). Standard beam search often produces K very similar sequences, which isn't helpful for diversity.</p>
<hr />
<h3 id="q9-when-would-you-use-beam-search-over-sampling-methods-like-top-p">Q9: When would you use beam search over sampling methods like top-p?<a class="headerlink" href="#q9-when-would-you-use-beam-search-over-sampling-methods-like-top-p" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> Use beam search for:
- <strong>Objective quality metrics</strong> (BLEU, ROUGE) that correlate with likelihood
- <strong>Structured outputs</strong> (translation, ASR) with one correct answer
- <strong>Deterministic requirements</strong> (reproducibility)</p>
<p>Use sampling for:
- <strong>Creative tasks</strong> requiring diversity
- <strong>Conversational AI</strong> needing personality
- <strong>Open-ended generation</strong> where many good answers exist</p>
<hr />
<h3 id="q10-how-does-beam-search-handle-the-eos-token">Q10: How does beam search handle the EOS token?<a class="headerlink" href="#q10-how-does-beam-search-handle-the-eos-token" title="Permanent link">&para;</a></h3>
<p><strong>Answer:</strong> When a beam generates EOS (end-of-sequence), it's marked as complete:
1. Complete beams stop expanding
2. They remain in the candidate pool with their final score
3. Active beams continue generating
4. Search terminates when all K beams complete or max_length reached
5. Return the complete beam with highest normalized score</p>
<p>Some implementations use length normalization to fairly compare complete sequences of different lengths.</p>
<hr />
<h2 id="10-code-example">10. Code Example<a class="headerlink" href="#10-code-example" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">def</span> <span class="nf">beam_search</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_ids</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">length_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
    <span class="n">eos_token_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Beam search decoding.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Language model</span>
<span class="sd">        input_ids: Starting tokens [1, seq_len]</span>
<span class="sd">        beam_width: Number of beams</span>
<span class="sd">        max_length: Maximum sequence length</span>
<span class="sd">        length_penalty: Alpha for length normalization</span>
<span class="sd">        eos_token_id: End of sequence token</span>

<span class="sd">    Returns:</span>
<span class="sd">        Best sequence found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">device</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">input_ids</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Initialize beams: (sequence, score, finished)</span>
    <span class="n">beams</span> <span class="o">=</span> <span class="p">[(</span><span class="n">input_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">seq</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">finished</span> <span class="ow">in</span> <span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">finished</span><span class="p">:</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">seq</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">finished</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="c1"># Get next token probabilities</span>
            <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">seq</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
                <span class="n">logits</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">log_probs</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Expand beam with top-K tokens</span>
            <span class="n">top_k_probs</span><span class="p">,</span> <span class="n">top_k_ids</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">log_probs</span><span class="p">,</span> <span class="n">beam_width</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">prob</span><span class="p">,</span> <span class="n">token_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">top_k_probs</span><span class="p">,</span> <span class="n">top_k_ids</span><span class="p">):</span>
                <span class="n">new_seq</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">+</span> <span class="p">[</span><span class="n">token_id</span><span class="o">.</span><span class="n">item</span><span class="p">()]</span>
                <span class="n">new_score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="n">prob</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">is_finished</span> <span class="o">=</span> <span class="p">(</span><span class="n">token_id</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">==</span> <span class="n">eos_token_id</span><span class="p">)</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_seq</span><span class="p">,</span> <span class="n">new_score</span><span class="p">,</span> <span class="n">is_finished</span><span class="p">))</span>

        <span class="c1"># Apply length penalty and keep top beams</span>
        <span class="k">def</span> <span class="nf">normalized_score</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">seq</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">penalty</span> <span class="o">=</span> <span class="p">((</span><span class="mi">5</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">**</span> <span class="n">length_penalty</span>
            <span class="k">return</span> <span class="n">score</span> <span class="o">/</span> <span class="n">penalty</span>

        <span class="n">beams</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">normalized_score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="n">beam_width</span><span class="p">]</span>

        <span class="c1"># Early stopping if all beams finished</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">finished</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">finished</span> <span class="ow">in</span> <span class="n">beams</span><span class="p">):</span>
            <span class="k">break</span>

    <span class="c1"># Return best sequence</span>
    <span class="n">best_seq</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">beams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">best_seq</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># Usage</span>
<span class="c1"># output = beam_search(model, prompt_ids, beam_width=5)</span>
</code></pre></div>
<hr />
<h2 id="11-key-takeaways-for-interviews">11. Key Takeaways for Interviews<a class="headerlink" href="#11-key-takeaways-for-interviews" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Definition:</strong> Maintains K candidate sequences, keeps top-K by cumulative probability</li>
<li><strong>Beam width K:</strong> Trade-off between quality (higher K) and speed (lower K)</li>
<li><strong>Length normalization:</strong> Essential to prevent bias toward shorter sequences</li>
<li><strong>Pros:</strong> Better than greedy, explores alternatives, good for structured tasks</li>
<li><strong>Cons:</strong> Computationally expensive (K× slower), low diversity, generic outputs</li>
<li><strong>Best for:</strong> Translation, ASR, captioning, summarization</li>
<li><strong>Worst for:</strong> Creative writing, dialogue, brainstorming</li>
<li><strong>Complexity:</strong> O(K × V × T) time, O(K × T) space</li>
</ol>
<hr />
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://arxiv.org/abs/1609.08144">Google's Neural Machine Translation System</a> - Length normalization formula</li>
<li><a href="https://arxiv.org/abs/1904.09751">The Curious Case of Neural Text Degeneration</a> - Discusses diversity issues</li>
<li><a href="https://arxiv.org/abs/1610.02424">Diverse Beam Search</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.top", "search.highlight", "search.share", "content.code.copy", "mathjax"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>